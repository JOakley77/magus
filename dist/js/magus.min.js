/*!
Package: magus (www.jasonthedev.com/plugins/magus)
Version: 1.0.0
Last updated: 2013-08-01
* Author: Jason Oakley <magus@jasonthedev.com>;
* Website: www.jasonthedev.com */
!function(a,b,c,d){var e="magus",f=function(c,d){var e={debug:!1,active_panel:0,disable_panels:!0,height:null,panel_height:null,active_can_close:!1,set_active_completed_on_show:!0,collapse_active_on_show:!0,disable_bs_transition:!0,show_icons:!0,acc_group_class:".accordion-group",acc_heading_class:".accordion-heading",acc_toggle_class:".accordion-toggle",acc_collapsible_class:".collapse",disabled_class:".magus-disabled",disabled_icon_class:"glyphicon glyphicon-ban-circle",show_disabled_icon:!0,active_class:".magus-active",active_icon_class:"glyphicon glyphicon-pushpin",show_active_icon:!0,inactive_class:".magus-inactive",inactive_icon_class:"glyphicon glyphicon-ok",show_inactive_icon:!0,completed_class:".magus-completed",completed_icon_class:"glyphicon glyphicon-ok-circle",show_completed_icon:!0,alert_class:".magus-alert",alert_icon_class:"glyphicon glyphicon-warning-sign",show_alert_icon:!0,trigger_goto:"[data-goto]",trigger_prev:'[data-goto="prev"]',trigger_next:'[data-goto="next"]',trigger_hide:"[data-hide]",trigger_show:"[data-show]",trigger_alert:"[data-alert]",trigger_disable:"[data-disable]",show_steps:!0,steps_position:"top",steps_node_element:"li",steps_class:".magus-steps",init:function(){}};return this.options=a.extend(!0,e,d),this.magus=a(c),this.steps=a(this.steps_class),this._init(c,d),b.magus=this,this};f.prototype._cleanSelector=function(a){return a.replace(".","")},f.prototype._init=function(){this._setup(),null!==this.options.height&&this.setAccordionHeight(this.options.height),this._hook("init",this),this._setupListeners()},f.prototype._setup=function(){var b=this,c=this.magus,e=this.options;c.data("defaultPanel")!==d&&(e.active_panel=c.data("defaultPanel")),c.data("disablePanels")!==d&&(e.disable_panels=c.data("disablePanels")),e.disable_bs_transition===!0&&(a.fn.collapse.Constructor.prototype.transition=function(){return!1}),c.last_active=e.active_panel,c.nodes=[],a.each(c.find(e.acc_group_class),function(b,d){var f=a(d);c.nodes.push({index:b,element:f,collapsible:f.find(e.acc_collapsible_class),target:f.find(e.acc_toggle_class).attr("href"),step:null,active:b===e.active_panel?!0:!1,disabled:b===e.active_panel?!1:e.disable_panels,completed:!1})}),e.show_steps===!0&&(b.steps=a(e.steps_class),a.each(b.steps.find(e.steps_node_element),function(d,f){var g=a(f),h=a.grep(c.nodes,function(a){return a.target===g.find("a").attr("href")});c.nodes[h[0].index].step=g,c.nodes[h[0].index].active===!0&&g.addClass(b._cleanSelector(e.active_class)),c.nodes[h[0].index].disabled===!0&&g.addClass(b._cleanSelector(e.disabled_class)),c.nodes[h[0].index].completed===!0&&g.addClass(b._cleanSelector(e.completed_class))})),a.each(c.nodes,function(a,c){c.active===!0&&b.show(a),c.disabled===!0&&b.setDisabled(c.index,!0)}),0===b.getActivePanel().index?a(e.trigger_prev).attr("disabled","disabled"):b.getActivePanel().index===c.nodes.length-1&&a(e.trigger_next).attr("disabled","disabled"),null!==e.panel_height&&b.setPanelHeight(e.active_panel,e.panel_height)},f.prototype._hook=function(a){var b=arguments;if(this.options[a]!==d){var c=this.options[a];return b[0]=this.self,c.apply(this,b)}},f.prototype.getActivePanel=function(){return a.grep(this.magus.nodes,function(a){return a.active})[0]},f.prototype._setIcon=function(a,b){var c,e=this.magus,f={requested:e.nodes[a]};switch(b){case"disabled":c=this.options.show_icons===!0||this.options.show_disabled_icon===!0?this.options.disabled_icon_class:null;break;case"active":c=this.options.show_icons===!0||this.options.show_active_icon===!0?this.options.active_icon_class:null;break;case"inactive":c=this.options.show_icons===!0||this.options.show_inactive_icon===!0?this.options.inactive_icon_class:null;break;case"completed":c=this.options.show_icons===!0||this.options.show_completed_icon===!0?this.options.completed_icon_class:null;break;case"alert":c=this.options.show_icons===!0||this.options.show_alert_icon===!0?this.options.alert_icon_class:null}if(null!==c){var g=f.requested.element.find(this.options.acc_toggle_class),h=g.find("span");h!==d&&h.length>0&&h.remove(),g.prepend('<span class="'+c+'"></span>')}},f.prototype._setupListeners=function(){var b=this,d=this.magus,e=this.options;a(c).on("click",e.trigger_goto,function(c){var e=a(c.currentTarget),f=e.data("goto"),g={active:b.getActivePanel(),requested:0};g.requested="prev"===f&&0!==g.active.index?g.active.index-1:"next"===f&&g.active.index!==d.nodes.length-1?g.active.index+1:parseInt(e.data("goto"),10),b.setGoTo(g.requested)}),a(c).on("click",e.trigger_hide,function(c){var e=a(c.currentTarget),f=e.data("hide"),g={active:b.getActivePanel(),requested:0};return console.log("hide"),g.requested="current"===f?g.active.index:parseInt(f,10),d.last_active=g.requested,b.hide(g.requested),!1}),a(c).on("click",e.trigger_show,function(c){var e=a(c.currentTarget),f=e.data("show"),g={active:b.getActivePanel(),last_active:d.last_active,requested:0};return console.log(d),console.log(d.last_active),console.log(g.last_active),console.log(f),console.log(parseInt(f,10)),g.requested="last"===f?g.last_active:parseInt(f,10),console.log("-",g.requested),b.show(g.requested),!1}),a(c).on("click",e.trigger_disable,function(c){var d=a(c.currentTarget);console.log("disable this"),b.setDisabled(parseInt(d.data("disable"),10),!0)}),a(c).on("click",e.trigger_alert,function(c){var d=a(c.currentTarget);b.setAlert(parseInt(d.data("alert"),10))})},f.prototype.setPanelHeight=function(a,b){var c=this.magus;return c.nodes[a].collapsible.height(parseInt(b,10)),c},f.prototype.setAccordionHeight=function(a){return this.magus.height(parseInt(a,10)),this.self},f.prototype.setAlert=function(a){var b=this,c=this.magus,e=this.options,f=c.nodes[a];return f!==d&&(f.element.addClass(b._cleanSelector(e.alert_class)),f.step.addClass(b._cleanSelector(e.alert_class)),b._setIcon(a,"alert")),c},f.prototype.setDisabled=function(a,b){var c=this,e=this.magus,f=this.options,g=e.nodes[a];return g!==d&&(b!==d&&b===!0&&(g.disabled=!0,g.element.addClass(c._cleanSelector(f.disabled_class)),g.step.addClass(c._cleanSelector(f.disabled_class)),c._setIcon(a,"disabled"),c._hook("onDisable")),b!==d&&b===!1&&(g.disabled=!1,g.element.removeClass(c._cleanSelector(f.disabled_class)),g.step.removeClass(c._cleanSelector(f.disabled_class)),c._hook("onEnable"))),e},f.prototype.complete=function(a,b){var c=this,e=this.magus,f=this.options,g=e.nodes[a];return g!==d&&(b!==d&&b===!0&&(g.completed=!0,g.element.addClass(c._cleanSelector(f.completed_class)),g.step.addClass(c._cleanSelector(f.completed_class))),b!==d&&b===!1&&(g.completed=!1,g.element.removeClass(c._cleanSelector(f.completed_class)),g.step.removeClass(c._cleanSelector(f.completed_class))),c._hook("onComplete")),this.self},f.prototype.show=function(b){var c=this,e=this.magus,f=this.options,g={active:a.grep(e.nodes,function(a){return a.active})[0],requested:e.nodes[b]};return f.collapse_active_on_show===!0&&c.getActivePanel()!==d&&c.hide(g.active.index),c._hook("beforeShow",g.active,g.requested),g.requested.active=!0,g.requested.element.removeClass(c._cleanSelector(f.inactive_class)).addClass(c._cleanSelector(f.active_class)),g.requested.element=a(f.acc_group_class).eq(g.requested.index),c._setIcon(b,"active"),g.requested.collapsible.collapse("show"),g.requested.step.removeClass(c._cleanSelector(f.inactive_class)).addClass(c._cleanSelector(f.active_class)),a.each(a(f.trigger_prev),function(){0!==g.requested.index?a(this).removeAttr("disabled"):a(this).attr("disabled","disabled")}),a.each(a(f.trigger_next),function(){g.requested.index!==e.nodes.length-1?a(this).removeAttr("disabled"):a(this).attr("disabled","disabled")}),null!==f.panel_height&&c.setPanelHeight(g.requested.index,f.panel_height),c._hook("afterShow",c,g.active,g.requested),this.self},f.prototype.hide=function(b){var c=this,e=this.magus,f=this.options,g={active:a.grep(e.nodes,function(a){return a.active}),requested:e.nodes[b]};return g.requested!==d&&(c._hook("beforeHide"),g.requested.active=!1,g.requested.element.addClass(c._cleanSelector(f.inactive_class)).removeClass(c._cleanSelector(f.active_class)).removeClass(c._cleanSelector(f.alert_class)),g.requested.element=a(f.acc_group_class).eq(g.requested.index),c._setIcon(b,"inactive"),g.requested.collapsible.collapse("hide"),g.requested.step.addClass(c._cleanSelector(f.inactive_class)).removeClass(c._cleanSelector(f.active_class)).removeClass(c._cleanSelector(f.alert_class)),null!==f.panel_height&&c.setPanelHeight(g.requested.index,0),c._hook("afterHide")),e},f.prototype.setGoTo=function(b,c){var e=this,f=this.magus,g=(this.options,{active:a.grep(f.nodes,function(a){return a.active}),requested:f.nodes[b]}),h=!0;return g.requested!==d&&(e.setDisabled(b,!1),c!==d&&c===!1&&(h=!1),e.complete(g.active[0].index,h),e.show(g.requested.index)),f};var g=a.fn.magus;a.fn[e]=function(b){if(!a(this).length)return a(this);var c=a(this).data(e);return c&&0!==b.indexOf("_")&&c[b]&&"function"==typeof c[b]?c[b](Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?(c?0===b.indexOf("_")?a.error("Method "+b+" is private!"):a.error("Method "+b+" does not exist."):a.error("Plugin must be initialized before using method: "+b),void 0):(c=new f(a(this),b),a(this).data(e,c),a(this))},a.fn.magus.noConflict=function(){return a.fn.magus=g,this}}(jQuery,window,document);